<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ChatNex - Smart AI Chatbot</title>

  <!-- SEO & Social tags (kept as before) -->
  <meta name="description" content="ChatNex is a free AI chatbot for smart searching and conversations. Ask anything and get instant answers.">
  <meta name="keywords" content="ChatNex, AI chatbot, smart search, free chatbot, conversational AI">
  <meta name="author" content="Your Name">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="ChatNex - Smart AI Chatbot">
  <meta property="og:description" content="ChatNex helps you search and chat instantly with AI.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yourwebsite.com">
  <meta property="og:image" content="https://yourwebsite.com/chatnex-preview.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ChatNex - Smart AI Chatbot">
  <meta name="twitter:description" content="ChatNex helps you search and chat instantly with AI.">
  <meta name="twitter:image" content="https://yourwebsite.com/chatnex-preview.png">

  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <header id="pageHeader">
    <h2>ChatNex</h2>
  </header>

  <div id="greeting" class="greeting">
    <p>Hello! I am ChatNex. How can I help you today?</p>
  </div>

  <main>
    <!-- chatbox is initially hidden; becomes visible after first submit -->
    <div id="chatbox" class="chatbox" role="log" aria-live="polite" aria-hidden="true">
      <!-- messages will be injected here by JS -->
    </div>
  </main>

  <!-- input fixed at bottom (always visible to allow trigger) -->
  <div class="input-wrap" role="search" aria-label="Chat input">
    <input id="userInput" type="text" placeholder="Type your message..." aria-label="Type your message" />
    <button id="sendBtn" aria-label="Send message">Send</button>
  </div>

  <div class="sidebar">
    
  <button class="clear-btn" id="clearChat">ðŸ§¹Clear chat</button>
</div>

<script>
  // ================================
  // ðŸŒ ChatNex Frontend â€” v2
  // ================================

  // UI elements
  const input = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');
  const chatbox = document.getElementById('chatbox');
  const header = document.getElementById('pageHeader');
  const greeting = document.getElementById('greeting');

  // ðŸŒ Your live Render backend endpoint
  const BACKEND_URL = "https://chatnex-ai-assistant.onrender.com/chat";

  // helper to append messages
  function addMessage(sender, text) {
    const msg = document.createElement('div');
    msg.className = `msg ${sender}`;
    msg.textContent = text;
    chatbox.appendChild(msg);
    chatbox.scrollTop = chatbox.scrollHeight;
    return msg;
  }

  // reveal chat UI
  function revealChatbox() {
  header.classList.add('hidden');
  greeting.classList.add('hidden');
  chatbox.classList.add('active');
  chatbox.setAttribute('aria-hidden', 'false');

  // ðŸ‘‡ Show the sidebar at the same time as chatbox
  const sidebar = document.querySelector('.sidebar');
  sidebar.classList.add('visible');

  setTimeout(() => chatbox.scrollTop = chatbox.scrollHeight, 120);
}


  // main send function
  async function sendMessage() {
    const message = input.value.trim();
    if (!message) return;

    // first-time reveal
    if (!chatbox.classList.contains('active')) {
      revealChatbox();
    }

    // display user message
    addMessage('user', message);
    input.value = '';
    sendBtn.disabled = true;
    input.disabled = true;

    // show typing...
    const typing = document.createElement('div');
    typing.className = 'msg bot';
    typing.textContent = 'Typing...';
    typing.style.fontStyle = 'italic';
    typing.style.opacity = '0.8';
    chatbox.appendChild(typing);
    chatbox.scrollTop = chatbox.scrollHeight;

    try {
      // timeout-safe fetch setup
      const controller = new AbortController();
      const timeoutMs = 20000; // 20 seconds
      const timeout = setTimeout(() => controller.abort(), timeoutMs);

      const res = await fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message }),
        signal: controller.signal
      });
      clearTimeout(timeout);

      const text = await res.text();
      let data = {};
      try {
        data = JSON.parse(text);
      } catch {
        data = { error: "Invalid JSON from server", raw: text };
      }

      // remove typing
      typing.remove();

      // handle response
      if (res.ok && data.reply) {
        addMessage('bot', data.reply);
      } else {
        addMessage('bot', "âš ï¸ " + (data.error || `Server error: ${res.status} ${res.statusText}`));
      }

    } catch (err) {
      typing.remove();
      if (err.name === 'AbortError') {
        addMessage('bot', "âš ï¸ Request timed out. The backend may be waking up (Render free plan).");
      } else {
        addMessage('bot', "âš ï¸ Network error: " + (err.message || err));
      }
    } finally {
      sendBtn.disabled = false;
      input.disabled = false;
      input.focus();
    }
  }

  // event listeners
  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keypress', e => {
    if (e.key === 'Enter') sendMessage();
  });

  window.addEventListener('load', () => input.focus());

const clearBtn = document.getElementById('clearChat');

clearBtn.addEventListener('click', () => {
  const confirmClear = confirm("ðŸ§¹ Are you sure you want to clear all messages?");
  if (confirmClear) {
    chatbox.innerHTML = '';
  }
});

</script>


</body>
</html>
